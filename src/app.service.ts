import { Inject, Injectable } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { OpenAI } from 'openai';
import { ChatCompletion, ChatCompletionMessageParam } from 'openai/resources';
import { Dialogs } from './entity/dialog.entity';
import { InjectRepository } from '@nestjs/typeorm';
import { Repository } from 'typeorm';

@Injectable()
export class AppService {
  constructor(
    @Inject(ConfigService) private configService: ConfigService,
    @InjectRepository(Dialogs) private readonly dialogs: Repository<Dialogs>,
  ) {}
  async chatAI(message: string): Promise<string> {
    try {
      const prompt = [{
        role: 'system',
        content : "รายละเอียดเงื่อนไขและวิธีการรับสิทธิประโยชน์จากการใช้จ่ายผ่านบัตรเครดิตของธนาคารต่างๆ ที่ศูนย์การค้าสยามฯ รวมถึงบัตรเครดิตกลุ่มที่มีคะแนนประเภท reserve และกลุ่มที่มีคะแนนสะสม พร้อมแหล่งอ้างอิง ดังนี้\n\n1. บัตรเครดิตกสิกรไทย - รับเครดิตเงินคืน 12% เมื่อใช้คะแนน K Point แลกเท่ายอดใช้จ่าย โดยลงทะเบียนผ่าน SMS [1]\n\n2. บัตรเครดิตกรุงเทพ - แลกคะแนนสะสมตามยอดใช้จ่าย รับเครดิตเงินคืนสูงสุด 16% จำกัดการแลกคะแนน 500,000 คะแนน ลงทะเบียนผ่าน SMS [2] \n\n3. บัตรเครดิตซิตี้แบงก์ - ใช้คะแนนสะสมเท่ายอดใช้จ่าย รับเครดิตเงินคืนสูงสุด 15% จำกัดการแลกคะแนน 100,000 คะแนน ลงทะเบียนที่จุดลงทะเบียน [3]\n\n4. บัตรเครดิตธนาคารออมสิน - ใช้คะแนน GSB Reward Point แลกเท่ายอดใช้จ่าย รับเครดิตเงินคืนสูงสุด 15% จำกัดแลกคะแนนสูงสุด 100,000 คะแนน ลงทะเบียนผ่าน SMS [4]\n\n5. บัตรเครดิตกรุงศรี - รับเครดิตเงินคืนสูงสุด 800 บาท, แลกคะแนนรับเครดิตเงินคืนเพิ่ม 10%, และแลกคะแนนรับ e-Coupon Siam Gift Card [5]\n\n6. บัตรเครดิต KTC - ใช้คะแนน KTC FOREVER เท่ายอดใช้จ่าย รับเครดิตเงินคืน 12% ลงทะเบียนแสกน QR Code [6]\n\n7. บัตรเครดิตคาร์ดเอ็กซ์และซีไอเอ็มบี - ใช้คะแนน CardX Rewards เท่ายอดซื้อ รับเครดิตเงินคืน 10-12% จำกัดแลกคะแนน 200,000 คะแนน ลงทะเบียนที่จุดลงทะเบียน [7]\n\n8. บัตรเครดิตธนาคารทหารไทย - ใช้คะแนนสะสมแลกเท่ายอดใช้จ่าย รับเครดิตเงินคืน 12-15% จำกัดแลกคะแนน 100,000 คะแนน ลงทะเบียนที่จุดลงทะเบียน [8]\n\nบัตรเครดิตกลุ่มที่มีคะแนนประเภท reserve:\n- ttb reserve infinite\n- ttb reserve signature  \n\nบัตรเครดิตกลุ่มที่มีคะแนนสะสม:\n- ttb absolute\n- ttb so fast\n- ttb royal top pass\n- TMB Absolute\n- TMB So Fast  \n- TMB Royal Top Brass\n- TBANK Black Diamond\n- TBANK Blue Diamond\n- TBANK Diamond\n\nโดยทุกธนาคารจะมีรายละเอียดเงื่อนไข ข้อยกเว้นประเภทบัตรที่ไม่ร่วมรายการ วิธีการแลกคะแนน และขั้นตอนการลงทะเบียนแตกต่างกันไป ควรศึกษารายละเอียดเพิ่มเติมจากเนื้อหาในเอกสารด้วยครับ\n\nรายละเอียดกิจกรรมและสิทธิประโยชน์ต่างๆ ดังนี้\n\n1. กิจกรรม \"ใบเสร็จมีค่า ยิ่งสะสม ยิ่งได้\" ที่สยามพารากอน สยามเซ็นเตอร์ สยามดิสคัฟเวอรี่ และไอคอนสยาม \n- สำหรับลูกค้าที่ดาวน์โหลดและลงทะเบียน ONESIAM SuperApp \n- ระยะเวลา 1-30 เม.ย. 66\n- นำใบเสร็จมาสะสมยอดใช้จ่าย รับรางวัล iPhone 14 Yellow 1 รางวัล, AirPods 3 2 รางวัล, 3,000 VIZ Coins 10 รางวัล  \n- สะสมยอดใช้จ่ายได้ที่ร้านค้าที่ระบุ โดยลำดับใบเสร็จเป็นตัวกำหนดผู้ชนะ\n- ประกาศผลวันที่ 31 พ.ค. 66 ทาง Facebook ONESIAM  \n- ผู้ชนะต้องแสดงบัตรประชาชนและ VIZ Profile รับรางวัลที่เคาน์เตอร์ VIZ ชั้น M สยามพารากอนระหว่าง 1-30 มิ.ย. 66\n\n2. คูปองซื้อเครื่องดื่ม KOI The'\'' ราคา 19 บาทจากราคาปกติ 55 บาท ที่สยามพารากอนและไอคอนสยาม\n- สำหรับลูกค้าที่ดาวน์โหลดและลงทะเบียน ONESIAM SuperApp สำเร็จครั้งแรก\n- ระยะเวลาเก็บคูปอง 1-30 เม.ย. 66 ใช้สิทธิ์ได้ 1 เม.ย. 66 - 15 พ.ค. 66\n- จำกัด 5,000 สิทธิ์ตลอดรายการ\n- แสดง QR Code คูปองให้ร้านเมื่อใช้สิทธิ์\n\n3. คูปองส่วนลด 300 บาท เมื่อช้อปตั้งแต่ 1,000 บาทขึ้นไปบน ONESIAM SuperApp  \n- สำหรับลูกค้าใหม่ที่ดาวน์โหลดและลงทะเบียนครั้งแรกเท่านั้น\n- ระยะเวลารับและใช้คูปอง 1-30 เม.ย. 66  \n- จำกัด 5,000 สิทธิ์ตลอดรายการ\n\n4. รับฟรี 100 VIZ Coins เมื่อช้อปและสะสมยอดใช้จ่ายตั้งแต่ 1,000 บาทที่ร้านค้าที่ระบุ\n- สำหรับสมาชิกใหม่ ONESIAM SuperApp ครั้งแรกเท่านั้น  \n- ระยะเวลารับและใช้สิทธิ์ 1-30 เม.ย. 66\n- จำกัด 5,000 สิทธิ์ตลอดรายการ\n- แสดงคูปองร่วมกับใบเสร็จเพื่อรับ 100 VIZ Coins ภายใน 24 ชม.\n\n5. แต่งหน้าฟรีที่ร้าน JUNGSAEMMOOL ตลอดปี (ไม่รวมกันคิ้ว, ติดขนตา)  \n- สำหรับสมาชิก ONESIAM SuperApp เท่านั้น\n- ต้องโทรจองสาขาล่วงหน้า 1 วันและแสดง VIZ Profile เมื่อรับสิทธิ์\n\n6. จอดรถฟรีเพิ่ม 2 ชม. ที่ไอคอนสยามและตึก ICS\n- สำหรับสมาชิก ONESIAM SuperApp เท่านั้น\n- แสดง VIZ Profile เพื่อรับสิทธิ์ที่เคาน์เตอร์ชั้น M ไอคอนสยาม  \n- ใช้สิทธิ์ได้ระหว่าง 1 เม.ย. 66 - 31 ธ.ค. 66\n\n7. ใบเสร็จมีค่า ยิ่งสะสม ยิ่งได้ ที่สยามเซ็นเตอร์\n- สำหรับสมาชิก ONESIAM SuperApp เท่านั้น \n- ระยะเวลา 1-30 เม.ย. 66\n- นำใบเสร็จขั้นต่ำ 100 บาทมาสะสมยอดที่ร้านค้าที่ระบุ\n- รับฟรี 10 VIZ Coins ต่อใบเสร็จ จำกัด 10 สิทธิ์/วัน 30 สิทธิ์/สมาชิกตลอดรายการ\n- ใช้ VIZ Coins ได้ถึง 30 มิ.ย. 66\n\n8. คูปองส่วนลด 100 บาท เมื่อใช้จ่ายขั้นต่ำ 300 บาทบน ONESIAM SuperApp พร้อมรับตั๋วหนังเมเจอร์ 1 ใบฟรี\n- สำหรับสมาชิก ONESIAM SuperApp เท่านั้น\n- ระยะเวลารับและใช้คูปอง 1-30 เม.ย. 66  \n- จำกัด 2,000 สิทธิ์ตลอดรายการ\n- รับตั๋วหนังเมเจอร์ใช้ได้ที่สาขาพารากอนและไอคอนสยามเท่านั้น\n\nมีรายละเอียดเงื่อนไขและข้อกำหนดเพิ่มเติมสำหรับแต่ละกิจกรรมและสิทธิประโยชน์ ซึ่งควรศึกษาเพิ่มเติมจากเนื้อหาในเอกสารด้วย\n\nรายการร้านค้าและบริการใน Siam Paragon แบ่งตามชั้นและประเภทสินค้า\n\nชั้น BF:\n- MR.SKY: รับเปลี่ยนแบตรีโมตรถยนต์, รับเจาะเข็มขัด\n- FLOWER DÉCOR\n- AUTO SPA\n- Sealife Ocean World / Show\n- Bag Studio: ซ่อมกระเป๋ารองเท้า \n\nชั้น GF:\nศูนย์อาหาร และร้านค้า เช่น\n- McDonald'\''s\n- MK Gold Restaurant\n- Fuji Japanese Restaurant\n- Starbucks Coffee\n- Gourmet Market ซึ่งมีร้านอาหารและสินค้าต่างๆ เช่น You Hunt We Cook, Wine Cellar, เครื่องเทศ, อาหารทะเลสด, สินค้าอุปโภค-บริโภค, ผักผลไม้ออร์แกนิค, ซูชิ, เนื้อ ฯลฯ\n- ร้านอาหารไทย ก๋วยเตี๋ยว ลูกชิ้น คอหมูย่าง ฯลฯ  \n- After You, Krispy Kreme, Ben'\''s Cookies ฯลฯ\nธนาคาร สถาบันการเงิน เช่น\n- ธนาคารกรุงเทพ\n- ธนาคารไทยพาณิชย์\n- ธนาคารทหารไทยธนชาต\n- ธนาคารกสิกรไทย\n- Krungsri Smart\n- Citi Advance\n- UOB Express\nร้าน Korean Street ขายผลิตภัณฑ์ความงามจากเกาหลี เช่น Nature Republic, Tony Moly, It'\''s Skin ฯลฯ\nร้านค้าแบรนด์ดัง เช่น Zara, H&M, Massimo Dutti, Uniqlo, Guess, Lacoste ฯลฯ\nร้านขายกระเป๋า รองเท้าแบรนด์เนม เช่น Aldo, Charles & Keith, Camper, Onitsuka Tiger ฯลฯ\nร้านเครื่องประดับ นาฬิกา เช่น De Preco, Glintz, Leila, King of Amulet ฯลฯ\nร้านเสื้อผ้า เช่น Ecco, DKNY\nร้านยา Boots\n\nชั้น 2F:\nร้านรถยนต์หรูหลายแบรนด์ เช่น Maserati, Bentley, Porsche, Lamborghini, Harley Davidson, Rolls Royce, BMW, Mini, Ducati, Aston Martin\nร้านบริการทางการเงิน เช่น Krungsri Smart\nร้านขายเครื่องเสียง เช่น Bose, Sony, Focal, Bang & Olufsen ฯลฯ\nร้านหนังสือ เช่น นายอินทร์ (Naiin), Asia Books, Kinokuniya \nร้านขายแว่นตา เช่น Glassaholic ซึ่งมีแบรนด์ต่างๆ เช่น Ray Ban, Oakley, Dior, Fendi ฯลฯ\nClinic และสถานบริการด้านความงาม\nร้านเสื้อผ้าบุรุษหลากหลายแบรนด์ เช่น Homme, Lacoste, Nautica, Pierre Cardin, Valentino Rudy ฯลฯ \nร้านขายกระเป๋าเดินทาง\nร้าน Adidas Brand Center, Osim, Prima Gold, Eye Lab, iStudio by Copperwired, Samsung, Vivo, Dyson, Linn\n\nชั้น 3F:\nแผนก IT ที่ขายสินค้าไอที คอมพิวเตอร์ มือถือ กล้อง ฯลฯ จากแบรนด์ต่างๆ มากมาย เช่น Banana, IT City, Power Buy, Jaymart\nร้าน Gadget ที่ขายสินค้าไอทีแปลกใหม่หลากหลาย\nร้านขายเครื่องเขียน อุปกรณ์สำนักงาน สมุดโน้ต \nร้านของเล่นเด็กหลากหลายแบรนด์ เช่น Lego, Hasbro, Mattel ฯลฯ\nร้านชุดว่ายน้ำชื่อดัง เช่น Speedo, Billabong, Roxy ฯลฯ\nร้าน Lingerie ชื่อดัง เช่น Wacoal, Triumph, Sabina, BSC ฯลฯ \nร้านเสื้อผ้าและอุปกรณ์กีฬา เช่น Nike, Adidas ฯลฯ\nร้านเฟอร์นิเจอร์แบรนด์ดัง เช่น BeConc ept by Index Livingmall, TrendDe sign, Barbara Barry, Pasaya, Ralph Lauren \nร้านของฝากของที่ระลึก เช่น Naraya\nร้านแว่นตา เช่น IC Berlin, Paris Miki\nร้านถ่ายรูป DJI & Hasselblad\n\nชั้น 4F:\nพื้นที่ร้านอาหาร ภัตตาคารหลากหลาย เช่น Lukkaithong, Sushi Den, Chabuton, Midtown ฯลฯ\nพื้นที่ Exotique Thai มีแบรนด์สปาและน้ำหอมไทย เช่น Harnn, Erb, Panpuri, Vuudh\nพื้นที่ SCBX Next Tech มีร้านค้าเทคโนโลยีหลายร้าน เช่น TikTok, Connex Space, Siam Sandbox by Jaymart\nพื้นที่ Bright Space มีโรงเรียนสอนศิลปะ เต้นรำ ดนตรี ภาษา เช่น Inlingua, Yamaha ฯลฯ รวมถึงคลินิกความงาม ทันตกรรม\nร้าน AIS, DTAC, True Branding\nธนาคารกรุงไทย, ออมสิน, กรุงศรี\nร้าน Fitness First\nร้านเฟอร์นิเจอร์ ของตกแต่งบ้าน ของใช้ในครัวจากแบรนด์ต่างๆ\nร้านของขวัญ ของที่ระลึก\nร้าน Pet Shop\n\nชั้น 5F:\nโรงภาพยนตร์ Paragon Cineplex, IMAX\nร้านอาหารและคาเฟ่ใน Paragon Cineplex เช่น Starbucks, Sushi Seki, KOF & Amattisimo  \nRoyal Paragon Hall สำหรับจัดงานอีเวนต์\n\nชั้น MF:\nแบรนด์เครื่องสำอาง น้ำหอม จากทั่วโลก เช่น CHANEL, NARS, MAC, Lancome, Estee Lauder, Sulwhasoo, Jo Malone, Penhaligon'\''s, Prada, Gucci, Hermes, Giorgio Armani ฯลฯ  \nแบรนด์แว่นตาและแว่นกันแดด เช่น Oakley, Ray Ban, Alexander McQueen\nแบรนด์แฟชั่นชั้นนำระดับโลกมากมาย เช่น Louis Vuitton, Cartier, Burberry, Jimmy Choo, Ermenegildo Zegna ฯลฯ\nร้านสินค้าไลฟ์สไตล์หรู เช่น Montblanc, Tumi ฯลฯ\nร้านนาฬิกาไฮเอนด์ เช่น Rolex, Cartier, Omega, Patek Philippe, Tudor, Van Cleef & Arpels ฯลฯ\nร้านเครื่องประดับเพชรพลอยชั้นสูง เช่น Tiffany & Co., Swarovski ฯลฯ\n\nรายการร้านค้าและบริการใน ICONSIAM, ICS และ Siam Center แบ่งตามชั้นและประเภทสินค้า มีดังนี้:\n\nICONSIAM:\n\nชั้น B2:\n- ICON WASH: บริการซักรีด \n- AIRPORTELS: บริการ Luggage Delivery\n- MISTER SKY SHOES & KEYS SERVICE: รับทำกุญแจและซ่อมรองเท้า \n\nชั้น B1: \n- DHL Express: บริการขนส่ง\n- Kerry Express: บริการขนส่ง\n- Thailand Post: ไปรษณีย์\n- Pet Safari: ร้านขายอาหารและอุปกรณ์สัตว์เลี้ยง\n- Sin Chai Hua: บริการซักอบรีด\n- MOMOKO Bag & Shoes Spa: บริการทำความสะอาดกระเป๋าและรองเท้า\n- Bhu Mhai Lifestyle Spa: สปา\n- EXPERT Watch: ร้านซ่อมนาฬิกา\n- ICONIC Your Design by Insider: ร้านปักชื่อ ออกแบบเสื้อยืด\n\nชั้น GF:\nร้านอาหารและเครื่องดื่ม:\n- Blue by Alain Ducasse: ภัตตาคารอาหารฝรั่งเศส\n- Jumbo Seafood: อาหารทะเลสิงคโปร์\n- TWG Tea: ร้านชาและของหวาน\n- Pang Cha by Lukkaithong: เครื่องดื่มและขนมไทย\n- Coffee Beans by Dao: คาเฟ่\n- OMU: ร้านราเมง\n- MOM'\''S TOUCH: ร้านไก่ทอด\n- MOS BURGER: ร้านเบอร์เกอร์\n\nร้านค้าแบรนด์เนม:\n- Hermes, Louis Vuitton: เครื่องหนัง\n- Cartier, Tiffany & Co.: เครื่องประดับ\n- Rimowa: กระเป๋าเดินทาง\n\nVeranda Zone:\n- D'\''ARK: Dinner Cruise\n- Ros'\''niyom: อาหารไทย\n- Bankara Ramen: ราเมนญี่ปุ่น\n- Zaab Eli: อาหารอีสาน\n- TAPAS by NAN Charcoal Grill: อาหารสเปน\n- Café Chili: คาเฟ่\n- Blue by Alain Ducasse Bakery Boutique: เบเกอรี่\n\nอื่นๆ:\n- SookSiam: โซนร้านค้าสินค้าไทย\n- 7-Eleven: ร้านสะดวกซื้อ\n- NaRaYa: ร้านกระเป๋าแบรนด์ไทย\n- Dear Tummy: ซูเปอร์มาร์เก็ตเพื่อสุขภาพ\n\nชั้น MF (ICONLUXE):\nแบรนด์เครื่องสำอาง ความงาม:\n- CHANEL, Dior, Estee Lauder, L'\''OCCITANE, M.A.C, Jo Malone, Atelier de Prestige\n\nแบรนด์แฟชั่นระดับโลก:\n- Gucci, Bottega Veneta, Cartier, Louis Vuitton, Hermes, Prada, Tiffany & Co., Dolce & Gabbana, Bulgari, Fendi, Saint Laurent, Dior, CELINE, Coach, Versace, Rimowa, Boss\n\nแบรนด์แฟชั่นอื่นๆ:\n- Michael Kors, Swatch, LONGCHAMP, Maison Kitsune, KWANPEN, Victoria'\''s Secret, H&M, COS, Urban Revivo, Zara, Bath & Body Works\n\nอื่นๆ:\n- Takashimaya (Department Store)\n\nชั้น 1: \nแบรนด์แฟชั่นและรองเท้า:\n- Louis Vuitton, COS, ZARA, Philipp Plein, Takashimaya, Evisu, Lacoste, Jelly Dreams, Fred Perry, Adidas Original, H&M, Onitsuka Tiger, BIRKENSTOCK, Samsonite, Champion, Shaka\n\nร้านอาหาร คาเฟ่:\n- % Arabica, Starbucks, Blue by Alain Ducasse\n\nอื่นๆ: \n- 333Gallery, Artventure Gallery, Agata Gallery (Art Gallery) \n- Maserati, Porsche, Dyson (รถยนต์และเครื่องใช้ไฟฟ้า) \n- Bang & Olufsen (เครื่องเสียง), L'\''occitane (ความงาม)\n\nชั้น 2:\nแบรนด์แฟชั่นและรองเท้า:\n- H&M, Uniqlo, Lyn, Lyn Around, Jelly Bunny, Charles & Keith, Levi'\''s, ALAND, CC DOUBLE O, New Era, ALDO, VANS, JD Sports\n\nแบรนด์ความงาม:\n- LUSH, Fashion TV Cosmetics\n\nอื่นๆ:\n- AIS, Greyhound Cafe, MINISO (ไลฟ์สไตล์), Watsons\n\nชั้น 3:\nร้านรถยนต์:\n- Lamborghini, BMW, Mercedes, Volvo, Porsche, Harley Davidson\n\nแบรนด์แฟชั่น รองเท้า กีฬา:\n- JD Sports, Converse, Crocs, VANS, New Balance, FILA, Reebok, Skechers, Under Armour, Nike ICON, Onitsuka Tiger, Lacoste, Swatch, Herschel, Eastpak, Jansport, Anello, The North Face\n\nร้านอาหารและคาเฟ่:\n- Buddhi Belly, Kyo Roll En\n\nอื่นๆ:\n- MUJI (ไลฟ์สไตล์), Loft\n\nชั้น 4:\nแบรนด์ไลฟ์สไตล์ ICONCRAFT หลากหลายแบรนด์\n\nร้านอาหาร เครื่องดื่ม:\n- Bar B Q Plaza, Shabushi, Café Amazon, Evaime Shabu Shabu, S&P, Tenjo Sushi, Bonchon, Baan Ice, LAEM CHAROEN SEAFOOD, Kub Kao'\'' Kub Pla\n- TrueCoffee, Susan Corissant\n\nธนาคาร:\n- SCB, Kasikornbank \n\nอื่นๆ:\n- True Sphere (ไอที), Harnn, THANN (ความงาม), Banana (กล้อง), AIS (มือถือ)\n\nชั้น 5:\nโซน Kids & Edutainment: \n- Babies Genius, Phonics 1st, Hit Galleria, Scientia, I-GENIUS KIDS, Robo Think, Quality Kids, Mothercare, KPN Music Academy, SE-ED, ABC The Baby\n- Viemus Music School, Yamaha Music School\n\nคลินิกความงาม สุขภาพ:\n- SLC Siam Laser Clinic, The Vanish Clinic, Pruksa Prime Clinic, Waleerat Clinic, HealthyMax, THONGLOR DENTAL HOSPITAL, Pewdee Clinic, MOGA, The Heritage Nail Spa, CHABA Nails & Eyelashes Pro, MILK\n\nร้านอาหาร:\n- Baan Ying Cafe & Meal, THIPSAMAI, LukKaiThong, Mae Sri Ruen, Crazy Rich Thai BBQ, MK LIVE, Hong Bao, Nice Two Meat U\n\nธนาคาร สถาบันการเงิน:\n- TMBThanachart Bank, Bank of Ayudhya, Krungthai Bank, UOB, TISCO Bank, GSB \n\nอื่นๆ: \n- Naiin (ร้านหนังสือ), Watsons, Toys R Us, Mt. Sapola (น้ำมันหอมระเหย)\n\nชั้น 6:\nร้านอาหาร คาเฟ่:\n- After You, ChaTraMue, Beard Papa, Gyukatsu Kyoto Katsugyu, James Boulangerie, Yuzu Ramen, Mil Toast House, Mo-Mo-Paradise, Bonchon, IPPUDO, YAYOI, Sushi Den, The Bibimbab, Great Harbor, Evaime Shabu Shabu, Guljak Topokki\n\nบริการ Entertainment: \n- FITNESS FIRST, TRUE ICON HALL, ICON CINECONIC, MEGA HarborLand\n\nชั้น 7:\n\nTRUE ICON HALL \nStarbucks Reserve\n\nICS:\n\nชั้น B2:\n- ICON WASH: บริการซักรีด\n\nชั้น B1:\n- Lotus'\''s Prive: ซูเปอร์มาร์เก็ต\n\nชั้น GF:\nร้านอาหาร เครื่องดื่ม:\n- MOM'\''S TOUCH, MOS BURGER, Get Fresh, OMU, Double Slash, ChaTraMue, NESwellL, Yoguruto\n\nอื่นๆ: \n- ForU Pharma (ร้านขายยา), 7-ELEVEN\n\nชั้น MF:\n- Starbucks (คาเฟ่)\n- Skechers, U.S. Polo, Pierre Cardin (แฟชั่น)\n- BEAUTRIUM, Oriental Princess, Cute Press (ความงาม) \n- Arin Jewly (เครื่องประดับ)\n\nชั้น 1:\n- The Ritz Clinic, Flash Nail, DOCTOR DELIGHT, Gangnam Clinic (คลินิกความงาม) \n- TOPCHAROEN, SEVEN DAYS OPTIC (แว่นตา)\n\nชั้น 2:\n- Watsons, Jaymart (ร้านขายของใช้ทั่วไป)\n- Premium Gold Yaowarat, Ventry (เครื่องประดับ)\n- Focus Store, Gadget House (ร้านอุปกรณ์ไอที)\n- Auntie Anne'\''s, Flash Coffee (ร้านอาหารและเครื่องดื่ม)\n\nชั้น 3:\n- Se-ed (ร้านหนังสือ)\n- Mr.D.I.Y (ร้าน DIY)\n- Muse Music Academy, INNER STUDIO (สอนดนตรี)\n- Santa Fe'\'', Daynighto (ร้านอาหารและเครื่องดื่ม)\n\nชั้น 4:\n- Joyliday (Entertaining) \n- KATEI SHABU, DURIAN MAHANAKORN, Earw thai Chinese cuisine, mamemi (ร้านอาหาร)\n- True Coffee, Siriraj H Solution\n\nSiam Center:\n\nชั้น 1:\nร้านแฟชั่น เครื่องประดับ:\n- Kloset, Smiley Hound, Seek'\''N Keep Club, FlyNow III, Minto, THANN, Pink Pussy Vintage, Tube Gallery, Gift Wonderland, Ake Ake, Hasguard, Panpuri, Fri 27 Nov, Good Mixer, Kloset Etc., Greyhound Original, Les Nereides, Frank Garcon\n\nโซน Absolute Siam ที่รวมแบรนด์ไทยกว่า 100 แบรนด์\n\nโซน The Wonder Room ที่รวมดีไซเนอร์ไทยหลากสไตล์\n\nอื่นๆ:\n- AIS, Starbucks, Baking Soda (ร้านกาแฟ ขนม)\n- Iconic (พวงกุญแจ ที่ห้อยกระเป๋า)\n- FabLab (รวมดีไซเนอร์อิสระ)\n\nชั้น 2:\nร้านอาหารหลากสัญชาติ เช่น\n- Tonkatsu Wako, Bar B Q Plaza, Yuzu Suki, Bonchon, Yayoi, Hachiban Ramen, After You, The Alley \n\nแบรนด์แฟชั่น เช่น \n- Levi'\''s, CC-OO, Havaianas, Villains, Charles & Keith, New Era, Lyn\n\nบริการ เช่น \n- Watsons, Pruksa Clinic, St. Peter Optical, AIS\n\nโซนร้านขนม เครื่องดื่ม เช่น \n- Minimelts, Fuku Matcha, Yenly Yours, Shiba-Jung, ERR, Candy Crush เป็นต้น\n\nชั้น 3:\n- Se-ed (ร้านหนังสือ)\n- Mr.DIY ร้าน DIY ทั่วไป\n- ร้านสอนดนตรี เช่น Muse Music Academy, INNER STUDIO\n- ร้านอาหาร Santa Fe\n- คาเฟ่ Daynighto\n- Skechers (รองเท้า)\n\nชั้น 4: (ส่วนใหญ่ปิดปรับปรุง)\n- TORA CHA (ชานมไข่มุก)\n- Muscle Inc. (อาหารเสริม)\n- You&I Premium Suki Buffet (บุฟเฟ่ต์ชาบู)\n\nชั้น MF:\nแบรนด์เครื่องสำอาง:\n- Oriental Princess, Cute Press \n\nแบรนด์แฟชั่น:\n- U.S. Polo, BEAUTRIUM, Pierre Cardin, Skechers, Ravipa, SHEPENDENCE, Zantiis, Swan, Charmmy & Tariz, Kiera Selbe, Rock Me, Cobalt, Harmenstone, Hydro Flask, Dr.Martens"
      ,
      }];
      const openai = new OpenAI({
        apiKey: this.configService.get('OPENAI_API_KEY'),
      });
      let responseText: string = '';
      const data: Dialogs[] = await this.dialogs.find(
        {
          order: {
            createTime: 'ASC',
          },
        }
      );
      let value = data.map((item) => {
        return {
          role: item.role,
          content: item.content,
        };
      });
      let content = [];
      content.push(...prompt,...value);

      const stream = await openai.chat.completions.create({
        model: 'gpt-3.5-turbo',
        messages: [
          ...content,
          { role: 'user', content: message },
        ],
        stream: true,
      });
      for await (const chunk of stream) {
        const content = chunk.choices[0]?.delta?.content;
        if (content) {
        responseText += content;
        process.stdout.write(content);
        }
      }
      await Promise.all([
        await this.dialogs.save({ role: 'user', content: message}),
        await this.dialogs.save({ role: 'assistant', content: responseText}),
      ]);
      return responseText;
    } catch (error) {
      throw error;
    }
  }
}
